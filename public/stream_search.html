<head>
</head>

<body>
  <input id="search" label="search">search</input>
  <table id="streamTable" class="">
  </table>
  <script>
    const twitchClientId = 'lqq3sny2wehwymql2bri1j6cbq89pi';
    //const xhr = new XMLHttpRequest();
    //xhr.onreadystatechange = function() {
    //  if (this.readyState == 4 && this.status == 200) {
    //    document.getElementById("streamTable")
    //      .innerHTML = '<h1>Hey there</h1>';
    //  }
    //};
    //xhr.open("GET", "row.html", false);
    //xhr.send();
    const getTwitchStreams = async (query) => {
      debugger;
      // put headers here for token
      const streamParams = await fetch(
          `https://api.twitch.tv/kraken/search/streams?q=${query}`, {
            headers: {
              "Client-ID": twitchClientId
            }
          })
        .then(function(response) {
          return response.json();
        });
      renderStream(table, streamParams);
    }
    const searchInput = document.getElementById("search");
    //TODO(theo): add listener on keypress
    searchInput.addEventListener("change", (function(e) {
      getTwitchStreams(e.target.value)
    }));
    const table = document.getElementById("streamTable");

    const renderStream = (table, streamParams) => {
      const row = table.insertRow(0);
      const displayName = streamParams.streams[0].channel.display_name;
      row.innerHTML = row.innerHTML + `<h2>${displayName}</h2>`;
      let thumbnailUrl = streamParams.streams[0].preview.small;
      thumbnailUrl = thumbnailUrl.replace(/{width}/, '400');
      thumbnailUrl = thumbnailUrl.replace(/{height}/, '225');
      row.innerHTML = row.innerHTML + `<img src=${thumbnailUrl} />`;
      const streamDescription = streamParams.streams[0].channel.status;
      row.innerHTML = row.innerHTML + `<h3>${streamDescription}</h3>`;
    }

    getTwitchStreams();

  </script>
</body>
